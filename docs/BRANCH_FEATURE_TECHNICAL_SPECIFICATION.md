# Техническое задание: Функциональность филиалов

## 1. Введение

### 1.1. Цель документа

Цель этого документа - определить технические требования и спецификации для реализации функциональности филиалов в приложении футбольной школы "Арсенал".

### 1.2. Обзор системы

Приложение футбольной школы "Арсенал" предназначено для управления тренировками, отслеживания прогресса учеников и взаимодействия между всеми участниками образовательного процесса. Система должна поддерживать несколько филиалов школы с возможностью разделения данных и управления доступом.

### 1.3. Термины и определения

- **Филиал** - Отдельное подразделение футбольной школы, имеющее свою территорию, тренеров и учеников
- **Привязка к филиалу** - Связь пользователя с определенным филиалом школы
- **Доступ по филиалам** - Ограничение видимости данных в соответствии с филиалом пользователя

## 2. Требования к функциональности

### 2.1. Управление филиалами

#### 2.1.1. Создание филиалов

**Описание:** Управляющие должны иметь возможность создавать новые филиалы.

**Требования:**

- Создание нового филиала с указанием названия, адреса и контактной информации
- Валидация обязательных полей
- Проверка уникальности названия филиала
- Сохранение информации в базе данных

**API Endpoints:**

- `POST /api/branches` - Создание нового филиала

#### 2.1.2. Редактирование филиалов

**Описание:** Управляющие должны иметь возможность редактировать информацию о филиалах.

**Требования:**

- Редактирование названия, адреса и контактной информации филиала
- Валидация данных при редактировании
- Сохранение изменений в базе данных

**API Endpoints:**

- `PUT /api/branches/{id}` - Обновление информации о филиале

#### 2.1.3. Удаление филиалов

**Описание:** Управляющие должны иметь возможность удалять филиалы.

**Требования:**

- Удаление филиала с сохранением связанных данных
- Подтверждение удаления
- Обработка зависимостей (пользователи, тренировки и т.д.)

**API Endpoints:**

- `DELETE /api/branches/{id}` - Удаление филиала

#### 2.1.4. Просмотр списка филиалов

**Описание:** Все пользователи должны иметь возможность просматривать список филиалов.

**Требования:**

- Получение списка всех филиалов
- Фильтрация и сортировка списка
- Пагинация для больших списков

**API Endpoints:**

- `GET /api/branches` - Получение списка филиалов
- `GET /api/branches/{id}` - Получение информации о конкретном филиале

### 2.2. Привязка пользователей к филиалам

#### 2.2.1. При регистрации

**Описание:** При регистрации пользователи должны указывать свой филиал.

**Требования:**

- Выбор филиала из списка существующих
- Обязательность выбора филиала
- Сохранение привязки в профиле пользователя

**API Endpoints:**

- `POST /api/users/register` - Регистрация пользователя с привязкой к филиалу

#### 2.2.2. Изменение привязки

**Описание:** Управляющие должны иметь возможность изменять привязку пользователей к филиалам.

**Требования:**

- Изменение филиала для пользователя
- Проверка прав доступа (только управляющие)
- Сохранение изменений в базе данных

**API Endpoints:**

- `PUT /api/users/{id}/branch` - Изменение филиала пользователя

#### 2.2.3. Просмотр привязки

**Описание:** Пользователи должны видеть информацию о своем филиале.

**Требования:**

- Отображение информации о филиале в профиле
- Возможность просмотра контактной информации филиала

**API Endpoints:**

- `GET /api/users/me` - Получение информации о текущем пользователе
- `GET /api/branches/{id}` - Получение информации о филиале

### 2.3. Фильтрация данных по филиалам

#### 2.3.1. Тренировки

**Описание:** Пользователи должны видеть только тренировки своего филиала.

**Требования:**

- Фильтрация тренировок по филиалу пользователя
- Возможность просмотра тренировок только своего филиала
- Управляющие могут видеть тренировки всех филиалов

**API Endpoints:**

- `GET /api/trainings` - Получение тренировок с фильтрацией по филиалу

#### 2.3.2. Новости

**Описание:** Пользователи должны видеть новости, относящиеся к их филиалу.

**Требования:**

- Фильтрация новостей по филиалу
- Возможность создания новостей для всех филиалов (SMM-менеджеры)
- Возможность создания новостей для конкретного филиала

**API Endpoints:**

- `GET /api/news` - Получение новостей с фильтрацией по филиалу
- `POST /api/news` - Создание новости с указанием филиала

#### 2.3.3. Рекомендации по питанию

**Описание:** Пользователи должны видеть рекомендации по питанию, соответствующие их филиалу.

**Требования:**

- Фильтрация рекомендаций по филиалу
- Возможность создания рекомендаций для всех филиалов
- Возможность создания рекомендаций для конкретного филиала

**API Endpoints:**

- `GET /api/nutrition` - Получение рекомендаций с фильтрацией по филиалу
- `POST /api/nutrition` - Создание рекомендации с указанием филиала

#### 2.3.4. Прогресс учеников

**Описание:** Тренеры должны видеть прогресс только учеников своего филиала.

**Требования:**

- Фильтрация прогресса по филиалу
- Тренеры видят только своих учеников
- Родители видят только своих детей
- Управляющие видят прогресс всех учеников

**API Endpoints:**

- `GET /api/progress` - Получение прогресса с фильтрацией по филиалу

### 2.4. Назначение тренеров филиалам

#### 2.4.1. Назначение тренера

**Описание:** Управляющие должны иметь возможность назначать тренеров филиалам.

**Требования:**

- Назначение тренера конкретному филиалу
- Проверка, что пользователь имеет роль тренера
- Сохранение назначения в базе данных

**API Endpoints:**

- `POST /api/branches/{id}/coaches` - Назначение тренера филиалу

#### 2.4.2. Отмена назначения

**Описание:** Управляющие должны иметь возможность отменять назначение тренеров филиалам.

**Требования:**

- Отмена назначения тренера филиалу
- Проверка прав доступа
- Обновление данных в базе

**API Endpoints:**

- `DELETE /api/branches/{id}/coaches/{coachId}` - Отмена назначения тренера

#### 2.4.3. Просмотр тренеров филиала

**Описание:** Управляющие должны иметь возможность просматривать тренеров, назначенных филиалу.

**Требования:**

- Получение списка тренеров филиала
- Фильтрация по филиалу
- Пагинация для больших списков

**API Endpoints:**

- `GET /api/branches/{id}/coaches` - Получение тренеров филиала

## 3. Требования к базе данных

### 3.1. Таблица филиалов

```sql
CREATE TABLE branches (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) NOT NULL UNIQUE,
  address TEXT,
  phone VARCHAR(50),
  email VARCHAR(255),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### 3.2. Изменения в таблице пользователей

```sql
ALTER TABLE users
ADD COLUMN branch_id INTEGER REFERENCES branches(id);
```

### 3.3. Таблица назначений тренеров

```sql
CREATE TABLE coach_branches (
  id SERIAL PRIMARY KEY,
  coach_id INTEGER REFERENCES users(id),
  branch_id INTEGER REFERENCES branches(id),
  assigned_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(coach_id, branch_id)
);
```

### 3.4. Индексы

```sql
CREATE INDEX idx_users_branch_id ON users(branch_id);
CREATE INDEX idx_branches_name ON branches(name);
CREATE INDEX idx_coach_branches_coach_id ON coach_branches(coach_id);
CREATE INDEX idx_coach_branches_branch_id ON coach_branches(branch_id);
```

## 4. Требования к API

### 4.1. Аутентификация и авторизация

Все endpoints, связанные с филиалами, должны быть защищены и доступны только авторизованным пользователям с соответствующими правами.

### 4.2. Форматы данных

Все API endpoints должны использовать JSON для передачи данных.

### 4.3. Обработка ошибок

API должен возвращать соответствующие HTTP статусы и сообщения об ошибках в стандартном формате.

## 5. Требования к интерфейсу

### 5.1. Экран регистрации

#### 5.1.1. Выбор филиала

**Описание:** На экране регистрации должен быть элемент выбора филиала.

**Требования:**

- Выпадающий список с филиалами
- Обязательность выбора
- Валидация выбора
- Отображение ошибок

#### 5.1.2. Роли и филиалы

**Описание:** Интерфейс должен учитывать роль пользователя при выборе филиала.

**Требования:**

- Для тренеров - выбор филиала работы
- Для родителей и детей - выбор филиала обучения
- Для управляющих - доступ ко всем филиалам

### 5.2. Экран профиля

#### 5.2.1. Отображение филиала

**Описание:** В профиле пользователя должна отображаться информация о филиале.

**Требования:**

- Отображение названия филиала
- Отображение контактной информации филиала
- Возможность перехода к информации о филиале

### 5.3. Экран управления филиалами

#### 5.3.1. Список филиалов

**Описание:** Управляющие должны иметь доступ к экрану управления филиалами.

**Требования:**

- Список всех филиалов
- Возможность создания нового филиала
- Возможность редактирования филиалов
- Возможность удаления филиалов

#### 5.3.2. Форма создания/редактирования

**Описание:** Форма для создания и редактирования информации о филиале.

**Требования:**

- Поля для названия, адреса, телефона, email
- Валидация полей
- Кнопки сохранения и отмены

### 5.4. Навигация

#### 5.4.1. Фильтрация контента

**Описание:** Навигация должна учитывать филиал пользователя при отображении контента.

**Требования:**

- Фильтрация данных по филиалу
- Отображение только релевантного контента
- Корректная работа всех экранов с учетом филиала

## 6. Требования к безопасности

### 6.1. Контроль доступа

#### 6.1.1. Роли и права

**Описание:** Система должна обеспечивать контроль доступа в соответствии с ролями и филиалами.

**Требования:**

- Тренеры имеют доступ только к данным своего филиала
- Родители имеют доступ только к данным своих детей
- Управляющие имеют доступ ко всем филиалам
- SMM-менеджеры могут создавать контент для всех филиалов

#### 6.1.2. Валидация на сервере

**Описание:** Все проверки доступа должны выполняться на сервере.

**Требования:**

- Проверка филиала пользователя при каждом запросе
- Проверка прав доступа к операциям
- Логирование попыток несанкционированного доступа

### 6.2. Защита данных

#### 6.2.1. Персональные данные

**Описание:** Система должна защищать персональные данные пользователей.

**Требования:**

- Шифрование паролей
- Защита персональных данных в transit и at rest
- Минимизация доступа к персональным данным

## 7. Требования к производительности

### 7.1. Время отклика

Все API endpoints должны отвечать в течение 500 мс при нормальной нагрузке.

### 7.2. Масштабируемость

Система должна поддерживать до 1000 одновременных пользователей.

### 7.3. Надежность

Система должна обеспечивать доступность 99.9% времени.

## 8. Требования к тестированию

### 8.1. Модульные тесты

Все сервисы и компоненты должны быть покрыты модульными тестами с покрытием не менее 80%.

### 8.2. Интеграционные тесты

Должны быть созданы интеграционные тесты для всех основных сценариев использования.

### 8.3. Приемочные тесты

Должны быть проведены приемочные тесты с участием представителей всех ролей пользователей.

## 9. Требования к документации

### 9.1. Техническая документация

Должна быть создана техническая документация по новой функциональности.

### 9.2. Пользовательская документация

Должна быть обновлена пользовательская документация с описанием новой функциональности.

### 9.3. API документация

Должна быть обновлена документация API с описанием новых endpoints.

# Скрипты управления базой данных

## Описание

В этом проекте есть несколько скриптов для управления базой данных PostgreSQL. Все скрипты находятся в директории [scripts/](scripts/).

## Список скриптов

### Инициализация базы данных

```bash
npm run db:init
```

Создает все необходимые таблицы в базе данных и заполняет их начальными данными.

### Проверка подключения

```bash
npm run db:check
```

Проверяет подключение к базе данных и выводит список доступных таблиц.

### Резервное копирование

```bash
npm run db:backup
```

Создает резервную копию базы данных в формате SQL и сохраняет ее в директории [backups/](backups/).

### Восстановление из резервной копии

```bash
npm run db:restore
```

Показывает список доступных резервных копий и позволяет восстановить базу данных из выбранной копии.

Для восстановления из конкретной копии:

```bash
node scripts/restore-database.js <имя-файла-резервной-копии>
```

### Очистка базы данных

```bash
npm run db:clear
```

Удаляет все данные из таблиц базы данных. Используется только для разработки и не может быть запущен в production окружении.

### Создание тестовых пользователей

```bash
npm run db:create-test-users
```

Создает тестовых пользователей для всех ролей в базе данных.

## Детали скриптов

### init-database.js

Инициализирует базу данных, создавая все необходимые таблицы и заполняя их начальными данными.

### check-database.js

Проверяет подключение к базе данных и выводит информацию о доступных таблицах.

### backup-database.js

Создает резервную копию базы данных в формате SQL. Файлы резервных копий сохраняются в директории [backups/](backups/) с именами в формате `goalschool-backup-YYYY-MM-DDTHH-MM-SS.sql`.

### restore-database.js

Позволяет восстановить базу данных из резервной копии. Перед восстановлением показывает список доступных резервных копий.

### clear-database.js

Очищает все таблицы в базе данных. Содержит защиту от случайного запуска в production окружении.

### create-test-users.js

Создает тестовых пользователей для всех ролей:

- admin@example.com (admin)
- manager@example.com (manager)
- coach@example.com (coach)
- parent@example.com (parent)
- student@example.com (student)

## Безопасность

1. Все скрипты используют параметры подключения из переменных окружения
2. Скрипт очистки базы данных содержит подтверждение и проверку окружения
3. Скрипт восстановления из резервной копии требует подтверждение перед выполнением
4. Резервные копии не содержат чувствительных данных (пароли хранятся отдельно)
5. Пароли тестовых пользователей хешируются перед сохранением в базу данных

## Рекомендации

1. Регулярно создавайте резервные копии базы данных
2. Храните резервные копии в безопасном месте
3. Тестируйте восстановление из резервных копий
4. Не используйте скрипт очистки базы данных в production окружении
5. Обновляйте переменные окружения при изменении параметров подключения
6. Используйте тестовых пользователей только для разработки и тестирования
7. Удалите тестовых пользователей из production базы данных

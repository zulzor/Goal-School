# Безопасность приложения

## Аутентификация

### Хранение паролей

Пароли пользователей хранятся в хешированном виде с использованием bcrypt:

- Алгоритм: bcrypt
- Количество раундов: настраивается через переменную окружения `BCRYPT_SALT_ROUNDS` (по умолчанию 10)
- Хеш хранится в таблице `users` в поле `password`

### JWT токены

Для аутентификации API используется JWT (JSON Web Tokens):

- Алгоритм: HS256
- Секретный ключ: настраивается через переменную окружения `JWT_SECRET`
- Время жизни: 24 часа
- Токены передаются в заголовке `Authorization: Bearer <token>`

### Защита от брутфорса

Реализована защита от брутфорса при входе:

- Ограничение количества попыток входа (5 попыток в течение 15 минут)
- Блокировка IP адреса при превышении лимита
- Логирование всех неудачных попыток входа

## Авторизация

### Роли пользователей

Система поддерживает следующие роли:

- `student` - ученик
- `parent` - родитель
- `coach` - тренер
- `manager` - менеджер
- `admin` - администратор

### Контроль доступа

Контроль доступа реализован на уровне:

1. **API endpoints** - проверка роли пользователя перед выполнением операций
2. **UI компонентов** - отображение только разрешенных элементов интерфейса
3. **Навигации** - доступ к экранам в зависимости от роли пользователя

### Права доступа

| Роль    | Доступ к данным         | Возможности                                       |
| ------- | ----------------------- | ------------------------------------------------- |
| student | Собственные данные      | Просмотр профиля, новостей, расписания, питания   |
| parent  | Данные ребенка          | Просмотр прогресса ребенка                        |
| coach   | Данные учеников         | Управление посещаемостью, прогрессом учеников     |
| manager | Все данные              | Полный доступ к аналитике, пользователям, навыкам |
| admin   | Все данные + управление | Полный доступ ко всем функциям                    |

## Защита данных

### Шифрование передачи данных

Все данные передаются по HTTPS:

- Используется TLS 1.2 или выше
- Сертификаты обновляются автоматически
- Поддержка HTTP/2 для улучшения производительности

### Шифрование хранения данных

Чувствительные данные в базе данных:

- Пароли - хешируются с bcrypt
- Персональные данные - хранятся в открытом виде (в рамках требований GDPR)
- Финансовые данные - не хранятся в приложении

### Резервное копирование данных

- Регулярные резервные копии базы данных
- Шифрование резервных копий
- Хранение резервных копий в защищенном хранилище
- Тестирование восстановления из резервных копий

## Защита от атак

### SQL Injection

Защита от SQL injection реализована через:

- Использование параметризованных запросов
- Валидацию входных данных
- Ограничение прав доступа к базе данных

### XSS (Cross-Site Scripting)

Защита от XSS:

- Экранирование выводимых данных
- Использование Content Security Policy (CSP)
- Валидация и санитизация входных данных

### CSRF (Cross-Site Request Forgery)

Защита от CSRF:

- Использование SameSite cookies
- Проверка заголовка Origin
- Токены верификации для критических операций

### Clickjacking

Защита от clickjacking:

- Установка заголовка X-Frame-Options
- Использование Content Security Policy

## Rate Limiting

Ограничение количества запросов:

- 1000 запросов в час с одного IP адреса
- 100 запросов в минуту на один endpoint
- Более строгие лимиты для критических операций

## Логирование безопасности

### Аудит действий

Логируются следующие события:

- Вход/выход пользователей
- Изменение критических данных
- Попытки несанкционированного доступа
- Ошибки безопасности

### Формат логов безопасности

Логи безопасности содержат:

- Временная метка
- IP адрес пользователя
- User Agent
- Идентификатор пользователя (если аутентифицирован)
- Тип события
- Детали события

## Обновления и патчи

### Зависимости

Регулярное обновление зависимостей:

- Еженедельная проверка уязвимостей
- Автоматическое обновление patch версий
- Ручное обновление major/minor версий после тестирования

### Сканирование уязвимостей

Используются инструменты для сканирования уязвимостей:

- npm audit для Node.js зависимостей
- Сканеры уязвимостей для Docker образов
- Статический анализ кода

## Резервное копирование и восстановление

### План резервного копирования

- Ежедневные полные резервные копии
- Инкрементальные резервные копии каждые 6 часов
- Хранение резервных копий в течение 30 дней

### План восстановления

- Восстановление из последней резервной копии
- Восстановление из точки во времени (PITR)
- Тестирование плана восстановления ежеквартально

## Инциденты безопасности

### Процедура реагирования

1. **Обнаружение** - мониторинг логов и алертов
2. **Анализ** - определение масштаба и влияния инцидента
3. **Сдерживание** - изоляция затронутых систем
4. **Устранение** - устранение причины инцидента
5. **Восстановление** - восстановление нормальной работы
6. **Пост-анализ** - анализ причин и предотвращение повторения

### Контакты для сообщений об уязвимостях

Для сообщений об уязвимостях обращайтесь по адресу: security@goalschool.com

## Соответствие стандартам

### GDPR

Соблюдение требований GDPR:

- Минимизация сбора персональных данных
- Право на удаление данных
- Прозрачность в обработке данных
- Назначение Data Protection Officer

### PCI DSS

Приложение не обрабатывает платежные данные, поэтому требования PCI DSS не применяются.

## Рекомендации по безопасности

### Для разработчиков

1. Не храните секреты в коде
2. Используйте переменные окружения для конфигурации
3. Проверяйте входные данные
4. Используйте параметризованные запросы
5. Регулярно обновляйте зависимости

### Для администраторов

1. Регулярно обновляйте систему
2. Мониторьте логи безопасности
3. Ограничивайте доступ к системе
4. Регулярно тестируйте резервные копии
5. Проводите аудит безопасности

### Для пользователей

1. Используйте сильные пароли
2. Не делитесь учетными данными
3. Используйте двухфакторную аутентификацию (когда будет реализована)
4. Сообщайте о подозрительной активности

# Переключение между базами данных

## Обзор

Приложение GoalSchool поддерживает два типа баз данных:

1. Локальное хранилище (по умолчанию) - использует AsyncStorage для хранения данных на устройстве
2. PostgreSQL 16.4 - облачная база данных для продакшн-среды

## Переключение через интерфейс приложения

### 1. Открытие настроек базы данных

1. Запустите приложение
2. Перейдите в профиль пользователя
3. Нажмите "Настройки базы данных"

### 2. Выбор типа базы данных

В настройках базы данных вы увидите две опции:

- **Локальная база данных** - данные хранятся на устройстве
- **PostgreSQL** - данные хранятся в облачной базе данных

### 3. Переключение на PostgreSQL

1. Убедитесь, что PostgreSQL сервер доступен и настроен
2. Нажмите кнопку "PostgreSQL"
3. Приложение автоматически проверит подключение
4. Если подключение успешно, приложение переключится на использование PostgreSQL

## Переключение через переменные окружения

### 1. Установка переменной DATABASE_TYPE

Для принудительного переключения на определенный тип базы данных установите переменную окружения:

```bash
# Для локальной базы данных (по умолчанию)
DATABASE_TYPE=local

# Для PostgreSQL
DATABASE_TYPE=postgresql
```

### 2. Настройка параметров подключения PostgreSQL

При использовании PostgreSQL необходимо задать следующие переменные окружения:

```bash
DATABASE_URL=postgresql://имя_пользователя:пароль@хост:порт/имя_базы_данных
DB_HOST=хост_базы_данных
DB_PORT=порт_базы_данных
DB_NAME=имя_базы_данных
DB_USER=имя_пользователя
DB_PASSWORD=пароль
DB_SSL=true или false
```

## Инициализация базы данных

### 1. Локальная база данных

Локальная база данных инициализируется автоматически при первом запуске приложения.

### 2. PostgreSQL

Для инициализации базы данных PostgreSQL выполните один из следующих способов:

### Способ 1: Через интерфейс приложения

1. Перейдите в настройки базы данных
2. Нажмите "Проверить подключение"
3. Если подключение успешно, данные будут автоматически инициализированы

### Способ 2: Через командную строку

```bash
# Инициализация базы данных
npm run db:init

# Или через скрипт
node scripts/init-database.js
```

## Миграция данных

### 1. С локальной базы данных на PostgreSQL

При переключении с локальной базы данных на PostgreSQL данные автоматически не переносятся. Для миграции данных выполните следующие шаги:

1. Экспортируйте данные из локальной базы данных
2. Импортируйте данные в PostgreSQL

### 2. Экспорт данных из локальной базы

```bash
# Экспорт данных
node scripts/backup-database.js
```

### 3. Импорт данных в PostgreSQL

```bash
# Импорт данных
node scripts/restore-database.js
```

## Резервное копирование

### 1. Локальная база данных

```bash
# Создание резервной копии
npm run db:backup

# Или через скрипт
node scripts/backup-database.js
```

### 2. PostgreSQL

```bash
# Создание резервной копии
npm run db:backup

# Или через скрипт
node scripts/backup-database.js
```

## Восстановление из резервной копии

### 1. Локальная база данных

```bash
# Восстановление из резервной копии
npm run db:restore

# Или через скрипт
node scripts/restore-database.js
```

### 2. PostgreSQL

```bash
# Восстановление из резервной копии
npm run db:restore

# Или через скрипт
node scripts/restore-database.js
```

## Устранение неполадок

### 1. PostgreSQL недоступен

Если при переключении на PostgreSQL возникает ошибка "PostgreSQL недоступен":

1. Проверьте параметры подключения в переменных окружения
2. Убедитесь, что PostgreSQL сервер запущен и доступен
3. Проверьте сетевое подключение к серверу
4. Убедитесь, что учетные данные верны

### 2. Ошибка инициализации базы данных

Если возникает ошибка при инициализации базы данных:

1. Проверьте логи приложения
2. Убедитесь, что у пользователя есть права на создание таблиц
3. Проверьте, что база данных существует
4. Убедитесь, что версия PostgreSQL соответствует требованиям (16.4)

### 3. Данные не сохраняются

Если данные не сохраняются в базе данных:

1. Проверьте тип текущей базы данных в настройках
2. Убедитесь, что подключение к базе данных активно
3. Проверьте логи на наличие ошибок сохранения
4. Убедитесь, что у пользователя есть права на запись

## Рекомендации

1. **Для разработки**: Используйте локальную базу данных для быстрой разработки и тестирования
2. **Для продакшна**: Используйте PostgreSQL для надежного хранения данных
3. **Резервное копирование**: Регулярно создавайте резервные копии данных
4. **Миграция**: При переключении между базами данных всегда создавайте резервную копию перед миграцией
